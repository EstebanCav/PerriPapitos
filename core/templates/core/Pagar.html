{% extends 'core/base.html' %}
{% load static %}
{% block contenido %}
<div class="payment-total">
    <h2>Pagar</h2>

    <form method="POST" action="{% url 'Carrito' %}">
        {% csrf_token %}
        <label for="total">Total: <span>${{ total_precio }}</span> </label>

        <label > Nombre tarjeta:</label>
        <input type="text" id="nombre_tarjeta" name="nombre_tarjeta" required>

        <label>Número de tarjeta:</label>
        <input type="text" id="numero_tarjeta" name="numero_tarjeta" required>

        <label >Fecha de expiración:</label>
        <input type="text" id="fecha_expiracion" name="fecha_expiracion" required>

        <label>CVV:</label>
        <input type="text" id="cvv" name="cvv" required>
        <p>${{ valor }}</p>
        <span>${{ valor }}</span>

        <p><div id="btnpaypal"></div></p>

    </form>
</div>
{% endblock %}


{% block js %}

    <script src="http://www.paypalobjects.com/api/checkout.js"></script>
    <script>
        paypal.Button.render({
            env: 'sandbox',
            client:{
                sandbox:'AbH3-GPxABHeRTQsxWESbeJgTnRZgFV1UZa3c3zRJpUW8tnizxXguXgEEFoNoxe2mxDi2g0WMDpgTIVH',
                production: 'demo_production_client_id'


            },
            locale:'es_CL',
            style:{
                size:'large', //small, medium, large
                color:'gold', //gold,black
                shape:'rect',  //pill,rect

            },
            commit: true,
            payment: function (data, actions) {
                return actions.payment.create({
                    transactions: [{
                        amount:{
                            total:'{{ valor }}', //MONTO A PAGAR
                            currency: 'USD' //USD, CN
                        }
                    }]

                });
            },
            onAuthorize: function(data, actions){
                return actions.payment.execute().then(function(){
                    Swal.fire({
                        title: 'Compra Realizada',
                        text: 'Su compra ha sido realizada exitosamente',
                        icon: 'success',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Confirmar'
                        }).then(function() {
                        window.location.href = "/Finalcompra/";
                    });



                    //zona para implementar logica despues de pagar

                });
            },
            onCancel(data){
                Swal.fire({
                        title: 'Transaccion Cancelada',
                        text: 'El pago ha sido cancelado',
                        icon: 'success',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Confirmar'
                        }).then(function() {
                        window.location.href = "/Carrito/";
                    });

            },
            onError(err){
                Swal.fire({
                        title: 'Error Transaccion',
                        text: 'Ha ocurrido un error',
                        icon: 'error',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Confirmar'
                        }).then(function() {
                        window.location.href = "/Carrito/";
                    });

            },


        }, '#btnpaypal');
    </script>

{% endblock %}